---
title: "상관분석 및 회귀분석"
---

## 분석 방법 선택 가이드 {#method-selection}

![슬라이드 81](../images/ch05/slide_81.png){width=100%}

주어진 목적과 실무적 상황에 따라 적절한 분석 방법을 선택함이 중요합니다. 수집되는 데이터의 형태에 따라 올바른 분석 방법을 결정할 수 있어야 합니다.

| 데이터 유형 | 분석 목적 | 도구 |
|-------------|----------|------|
| **연속형** | 평균 비교 | t-Test, ANOVA |
| | 분산 비교 | Equal Variance, 2-Variance |
| | 관계 분석 | Correlation, Regression |
| | 인자 Screening | DOE (2^n 완전배치, 2^(n-k) 부분배치) |
| **이산형** | 독립성 검정 | Chi-Square |
| | 비율 비교 | Proportion |

---

## 상관분석 (Correlation Analysis) {#correlation}

### 상관관계란?

![슬라이드 82](../images/ch05/slide_82.png){width=100%}

서로 관계가 있는 두 변량 사이에 한쪽이 증가하면 다른 쪽도 증가(또는 감소)하는 경향이 있을 때, 이 두 변량 사이에는 **상관관계가 있다**고 합니다.

| 유형 | 설명 | 예시 |
|------|------|------|
| **양의 상관관계** | x 증가 시 Y도 증가하는 경향 | 키가 큰 사람은 일반적으로 몸무게가 무겁다 |
| **음의 상관관계** | x 증가 시 Y가 감소하는 경향 | 생산량이 늘어나면 가격이 하락하는 경향 |
| **무 상관관계** | x 증감 시 Y가 아무런 경향을 갖지 않음 | 기온의 높낮이와 풍속 |

### 상관계수 (Correlation Coefficient)

![슬라이드 83](../images/ch05/slide_83.png){width=100%}

상관관계의 정도를 수치로 표현한 것이 **상관계수(r)**입니다. 측정된 두 변수의 **선형적인 밀접도**를 나타냅니다.

$$r = \frac{\sum(x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum(x_i - \bar{x})^2 \sum(y_i - \bar{y})^2}}$$

**상관계수의 성질:**

- 항상 **-1과 1 사이**에 있음
- -1과 1은 **완전한 직선 관계**
- 점들이 직선에 얼마나 모여 있는가를 나타냄
- **이상점에 영향을 받음**
- |r| ≥ 0.8이면 강한 상관관계가 있다고 함
- 고려한 x 또는 y의 **범위에 영향**을 받음

### 상관 분석의 가설검정

![슬라이드 84](../images/ch05/slide_84.png){width=100%}

**상관 분석**: 두 변수 간의 관련성을 연구하는 통계적 방법

- 두 변수 간의 **선형(Linear) 관계의 유무**를 확인
- 선형 이외의 관계가 존재할 수 있으나, 이는 상관분석을 통해 진단되지 않음

**모상관계수(ρ)에 대한 가설검정:**

- H₀: ρ = 0 (상관관계 없음)
- H₁: ρ ≠ 0 (상관관계 있음)
- P-value < α이면 H₀를 기각

::: {.callout-warning title="주의사항"}
- 상관관계는 **인과관계를 나타내지 않음**
- 고려한 x 또는 Y의 **범위에 영향**을 받음
- **이상점의 영향**을 많이 받음 — 이상점 1개로 인하여 상관계수 값이 크게 변할 수 있음
:::

### 상관성과 인과관계

![슬라이드 85](../images/ch05/slide_85.png){width=100%}

::: {.callout-important title="상관관계 ≠ 인과관계"}
| 사례 | 상관관계 | 인과관계 |
|------|---------|---------|
| 안전벨트 착용률과 피해 감소율 | 양의 상관관계 | **인과관계 성립** |
| 수능 성적과 대학 학점 | 상관관계 존재 | **다른 인자가 모두 영향** (학업능력, 지식의 결합이 둘 모두에 영향) |
| COVID-19 환자수와 주가지수 | 양의 상관관계 | **우연한 상관관계** |
:::

### 실습: 상관분석

![슬라이드 86](../images/ch05/slide_86.png){width=100%}

**실습 조건 (STB 3.7):** OO제품에서 Digital Video 녹화 시 Disk 저장성능(Response)에 영향을 주는 요인(BlockSize, WriteCount)에 대해 조사. 57개의 조합에서 저장성능을 확인.

![슬라이드 87](../images/ch05/slide_87.png){width=100%}

**Minitab 경로:** Stat > Basic Statistics > Correlation Analysis

- 원하는 변수 모두 지정하되, Y에 해당하는 항목(Response)을 **가장 먼저 지정**

![슬라이드 88](../images/ch05/slide_88.png){width=100%}

**결과 해석:**

- WriteCount는 Response와 비교적 **강한 상관관계** (-0.820)
- BlockSize는 **약한 상관관계** (0.457)
- 유의수준 0.05하에서 BlockSize, WriteCount는 Response와 **상관관계가 있다**고 말할 수 있음

---

## 회귀분석 (Regression Analysis) {#regression}

### 회귀분석이란?

![슬라이드 89](../images/ch05/slide_89.png){width=100%}

**회귀(Regress)**의 원래 의미는 옛날 상태로 돌아가는 것을 의미합니다. 영국의 유전학자 **Francis Galton**은 부모와 자녀의 키 사이에 선형적인 관계가 있고, 키가 전체 평균으로 돌아가려는 경향이 있다는 가설을 세우고, 이를 분석하는 방법을 "회귀분석"이라 하였습니다.

**회귀분석 사용 목적:**

1. **치명인자(Vital Few)를 선별**하기 위해
2. x 값의 변화에 따른 **Y 값을 추정 또는 예측**하기 위해
3. 어떤 x 인자들의 수준 값에서 **Y가 최적화**되는지를 결정하기 위해

$$Y = f(x_1, x_2, \ldots, x_k) + \varepsilon$$

### 회귀분석의 종류

![슬라이드 90](../images/ch05/slide_90.png){width=100%}

| 구분 | 독립변수 수 | 모형 유형 |
|------|-----------|----------|
| **단순 선형 회귀** | 1개 | 선형 |
| **다중 선형 회귀** | 2개 이상 | 선형 |
| **비선형 회귀** | - | 지수, 로그 등 |

### 회귀분석의 기본 절차

![슬라이드 91](../images/ch05/slide_91.png){width=100%}

```
Data Resume → 가정의 확인 → 모형의 선택 → 모수의 추정 → 이상점/영향점 진단
               (정규성,       (변수 선택,    (Fitting    → 모형의 적합성 확인
                독립성,        공선성 진단)    With Data)     (설명력, LOF Test,
                등분산성)                                      잔차 진단)
```

---

## 단순 선형 회귀분석 (Simple Linear Regression) {#simple-regression}

![슬라이드 92](../images/ch05/slide_92.png){width=100%}

Response와 1개의 Predictor간의 관계를 고찰하는 모형. 함수적 관계는 **선형성을 가정**.

$$Y = \beta_0 + \beta_1 X + \varepsilon, \quad \varepsilon \sim N(0, \sigma^2) \text{ (iid)}$$

**모형의 타당성 검증 3가지:**

1. p-value에 기반한 타당성 확인: **회귀 모형**, **회귀 계수**
2. 설명력(결정계수) 확인: **R², R²(adj), R²(pred)**
3. 잔차 진단: **LoF test**, 잔차 그래프(정규성, 독립성, 등분산성)

→ **1~3의 세 가지를 모두 만족해야만** 모형이 타당하다고 할 수 있음

::: {.callout-note title="용어" collapse="true"}
회귀분석에서 독립변수(x's)를 한글로는 인자라고 이야기하지만 영어로는 factor라 하지 않고 **predictor**라고 표현합니다.

- **iid**: Independent and Identically Distributed random variables (독립적이고 동일한 분포의 랜덤 변수)
:::

### 실습: 단순 선형 회귀

![슬라이드 93](../images/ch05/slide_93.png){width=100%}

**실습 조건 (STB 3.7):** 저장성능을 최적화하고자 Write Count와 저장성능의 관계를 파악하기 위해 실험을 수행.

**(1) Graph analysis**: 저장성능과 Write Count는 직선의 관계를 가지고 있는 것으로 판단됨.

![슬라이드 94](../images/ch05/slide_94.png){width=100%}

**(2) Regression analysis**

**Minitab 경로:** Stat > Regression > Regression > Fit Regression Model

![슬라이드 95](../images/ch05/slide_95.png){width=100%}

**결과 해석:**

1. 회귀식: **저장성능 = 156.14 – 0.000113 × WriteCount**
2. **상수항(Constant)의 유의성 검정**: H₀ "상수항은 0이다" → 기각 (유의)
3. **인자(계수)의 유의성 검정**: H₀ "계수항은 0이다(기울기가 0)" → 기각 (유의)
4. **설명력**: R-Sq와 R-Sq(adj)가 1에 가까울수록 좋은 모형

::: {.callout-tip title="R² 관련 유의사항" collapse="true"}
- R-Sq(adj)는 독립변수가 **2개 이상일 경우**에 사용하며, R-Sq와 함께 보는 것이 좋음
- R-Sq와 R-Sq(adj) 값의 차이가 크다면 **인자 선택에 오류**가 있을 수 있음
- 기울기가 0이면 모형을 이용해 예측하는 것이 **무의미** (항상 동일)
- 이상점에 의한 영향을 **민감하게 반영** — 1에 가까울수록 바람직
:::

### 잔차 진단

![슬라이드 96](../images/ch05/slide_96.png){width=100%}

**잔차에 대한 통계적 가정:**

- **정규성**: f(X)에 의해 설명된 체계적 관계를 제외한 측정/관측/표본 오차는 정규분포
- **등분산성**: 고려한 모든 x의 범위에서 추정의 정도(precision)는 동일
- **독립성**: 개별 관측값들은 서로 아무런 관계(특정한 패턴)가 없음

| 잔차 종류 | 설명 |
|-----------|------|
| **정규 잔차 (Regular)** | 관측치와 적합치의 차이. 일반적으로 "잔차(eᵢ)"라고 표현 |
| **표준화 잔차 (Standardized)** | 잔차를 잔차의 표준편차 추정치로 나눈 값. 내적 스튜던트화 잔차라고도 함 |
| **외적 스튜던트화 잔차 (Deleted)** | i번째 관측치를 제외하고 계산된 모형의 적합치와 yᵢ 간 차이 |

::: {.callout-note}
표준화 또는 외적 스튜던트 잔차값이 **±2보다 크면 이상점**으로 간주 (±2.5 또는 3 이상 기준도 사용)
:::

![슬라이드 97](../images/ch05/slide_97.png){width=100%}

잔차 구조는 각 조건에 크게 위배되지 않으나, 정규성 검정을 해볼 필요가 있습니다.

### 신뢰구간과 예측구간

![슬라이드 98](../images/ch05/slide_98.png){width=100%}

**Minitab 경로:** Stat > Regression > Fitted Line Plot

| 구간 | 의미 | 활용 |
|------|------|------|
| **95% CI** | 반응값 **평균**들의 95%가 존재할 대역 | 목표를 정할 때 |
| **95% PI** | **개별 값**들의 95%가 존재할 대역 | 스펙을 결정할 때 |

### LOF (Lack of Fit) Test

![슬라이드 99](../images/ch05/slide_99.png){width=100%}

독립변수의 한 수준 이상에서 **반복이 있는 경우**, 추정된 모형의 적합성을 검증합니다.

$$SS_T = SS_R + SS_E = SS_R + SS_{LOF} + SS_{PE}$$

| 항목 | 설명 |
|------|------|
| **LOF Error** | 추정된 f(x)와 반복 측정된 데이터 수준에서의 평균값과의 차이 |
| **Pure Error** | 반복된 수준에서의 평균값과 개별 관측값과의 차이 |

**가설:** H₀: 현재의 모형이 타당하다 / H₁: 현재의 모형이 타당하지 않다

- p-value가 **클수록** 현재 모형의 타당성을 더 지지

::: {.callout-warning}
회귀분석에서 예측 시 측정된 구간을 벗어난 추정은 오판할 위험이 있으므로 **외삽(extrapolation)은 하지 말 것**.
:::

### Think About

![슬라이드 100](../images/ch05/slide_100.png){width=100%}

::: {.callout-tip title="회귀분석 Q&A" collapse="true"}

![슬라이드 101](../images/ch05/slide_101.png){width=100%}

**Q1**: 추정된 회귀식과 설명력(R²)이 동일하다면, 고려된 데이터의 형태는 비슷할 것이다? → **NO**

**Q2**: Predictor의 회귀계수가 유의하면, 가정된 모형이 적절하다? → **NO** (곡선회귀를 적용하는 것이 바람직한 경우도 있음)

**Q3**: Predictor의 회귀계수가 유의하지 않으면, 중요하지 않은 Predictor이다? → **NO** (곡선회귀 적용 시 유의할 수 있음)

**Q4**: Predictor가 0일 때 Response가 0이라면, 회귀모형의 절편을 가정하지 말아야 한다? → **NO** (경험적 모형에서 절편은 유의하지 않더라도 가능한 한 포함하고, 실무적으로 의미가 없다면 해석하지 않음)
:::

### 예제2: 이상점 제거를 통한 모형 최적화

![슬라이드 102](../images/ch05/slide_102.png){width=100%}

Fan2와 내부온도(Response)간의 단순회귀모형을 구하는 사례입니다.

![슬라이드 103](../images/ch05/slide_103.png){width=100%}

- 유의수준 0.05하에서 predictor의 회귀계수는 **유의**
- LOF Test: 현재 가정된 모형이 타당하지 않다고 할 수 없음
- 1, 4번의 측정값으로 인해 **정규성에 문제** → 이상치 제거 필요

![슬라이드 104](../images/ch05/slide_104.png){width=100%}

**이상점 제거 방법**: Brush 기능 → Data > Subset Worksheet

![슬라이드 105](../images/ch05/slide_105.png){width=100%}

이상점 제거 후 분석 → 추가 이상점 확인

![슬라이드 106](../images/ch05/slide_106.png){width=100%}

**결과 비교**: 이상점을 교정한 경우와 교정하지 않은 경우를 비교합니다.

::: {.callout-note}
구해진 함수 관계가 **인과관계인가를 실무적으로 확인**해 보아야 합니다. Picture Mode가 'Standard', Bright가 'High' 조건에서 4번 Chamber의 측정치에서 이상점이 자주 발생하므로 핵심 원인을 규명할 필요가 있습니다.
:::

---

## 다중 선형 회귀분석 (Multiple Linear Regression) {#multiple-regression}

![슬라이드 107](../images/ch05/slide_107.png){width=100%}

Response와 **여러 개의 Predictor**간의 관계를 고찰하는 모형 분석입니다.

$$Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \cdots + \beta_k X_k + \varepsilon$$

**다중 공선성 (Multicollinearity)**: 고려된 predictor들 간에 선형관계가 존재하는 것. 공선성이 심한 경우 **회귀계수의 해석이 무의미**합니다.

**VIF (Variance Inflation Factor)**: 다중 공선성을 진단하는 계량 척도

$$VIF_j = \frac{1}{1 - R_j^2}$$

| VIF | 판정 |
|-----|------|
| < 5 | 문제없음 |
| 5 ~ 10 | 주의 |
| > 10 | 다중공선성 문제 있음 |

### 변수 선택 방법

![슬라이드 108](../images/ch05/slide_108.png){width=100%}

| 방법 | 설명 |
|------|------|
| **Forward Selection** | 최상의 기여를 하는 Predictor를 **하나씩 추가**. 포함된 Predictor는 계속 남음 |
| **Backward Elimination** | 모든 Predictor를 포함한 모형에서 기여도가 가장 적은 Predictor부터 **차례로 제거**. 제거된 Predictor는 다시 포함 불가 |
| **Stepwise** | Forward Selection + Backward Elimination. 선택된 Predictor도 **다시 제거 가능** |

::: {.callout-note title="Mallow's Cp" collapse="true"}
적합된 회귀 모형의 추정 능력을 수량화하여 모형 선택의 기준이 되도록 계량화된 척도입니다.
:::

### 실습: 다중 선형 회귀

![슬라이드 109](../images/ch05/slide_109.png){width=100%}

**실습 조건 (STB 3.8):** 특정 제품의 투과율(Response)에 영향을 주는 5가지 성분(Ing1~Ing5)에 대해 26개의 제품을 임의로 선정하여 분석.

#### (1) Variable Selection I - 전체 모형

![슬라이드 110](../images/ch05/slide_110.png){width=100%}

**Minitab 경로:** Stat > Regression > Regression > Fit Regression Model

![슬라이드 111](../images/ch05/slide_111.png){width=100%}

**결과:** 전체 5개 변수를 포함한 모형에서 Ing4(P=0.922)와 Ing1(P=0.493)은 유의하지 않으며, VIF가 10 이상인 변수가 있어 **다중 공선성** 문제가 있습니다. 유의하지 않은 변수를 순서대로 **풀링(제거)** 합니다.

![슬라이드 112](../images/ch05/slide_112.png){width=100%}

Ing4를 제거 후 재분석 → Ing1을 추가 제거

![슬라이드 113](../images/ch05/slide_113.png){width=100%}

**최종 결과:** Ing2, Ing3, Ing5만으로 구성된 최적 회귀모형

- 공선성 문제 해소 (VIF < 10)
- 모든 변수가 유의

::: {.callout-note title="다중 공선성에 대한 이해" collapse="true"}
다중 공선성이 있더라도 모형 자체가 잘못되었다고는 할 수 없습니다. 인자의 수가 많으면 모형이 복잡해지고, 경제성 측면에서 **통제해야 할 인자를 최소화**하는 것이 바람직합니다. 예를 들어, a인자의 변화에 대해 b인자가 매우 민감하게 따라 변한다면 어느 한 개의 인자만 통제해도 Y값의 변화는 크지 않을 것입니다.
:::

#### (1') Stepwise 등 변수 선택 방법 비교

![슬라이드 114](../images/ch05/slide_114.png){width=100%}

변수 선택 방법(Stepwise, Forward, Backward)을 변경하면서 결과의 차이를 확인합니다. Alpha 값은 15%, 10% 등으로 직접 입력할 수 있습니다.

#### (2) Best Subsets

![슬라이드 115](../images/ch05/slide_115.png){width=100%}

**Minitab 경로:** Stat > Regression > Regression > Best Subsets

- Cp 기준에서는 변수 4개가 가장 좋은 결과를 제공
- 적은 변수로 최적의 예측안을 구하려면 **변수 3개(Ing2, Ing3, Ing5)**가 유리

#### (3) Check Multicollinearity

![슬라이드 116](../images/ch05/slide_116.png){width=100%}

변수 선택을 통해 확인된 변수만으로 다중 공선성을 재진단합니다.

![슬라이드 117](../images/ch05/slide_117.png){width=100%}

선택된 Predictor들 간의 공선성이 존재하지 않으므로, **회귀 계수의 해석이 적절**합니다.

#### (4) Residual Analysis

![슬라이드 118](../images/ch05/slide_118.png){width=100%}

표준화 잔차값이 **±2보다 크면 이상점**으로 볼 수 있습니다. Brush 기능을 이용하여 이상점 제거 후 재분석이 필요합니다.

#### (5) 최종 모형

![슬라이드 119](../images/ch05/slide_119.png){width=100%}

**최종 모형에 대한 해석:**

1. 가정된 모형에서 **잔차 진단은 모두 만족**
2. 고려한 데이터의 범위에서 투과율은 **Ing2, Ing3, Ing5에 유의한 영향**을 받음
3. 유의한 Predictor가 단위당 변할 때 Response는 추정된 회귀계수만큼의 평균 변화량을 가짐 (추정된 회귀계수의 **상대적 비교는 적절하지 않음**)
4. 추정된 모형의 설명력은 **99.72%**

### 예측 (Prediction)

![슬라이드 120](../images/ch05/slide_120.png){width=100%}

**Minitab 경로:** Stat > Regression > Regression > Predict

(Ing2, Ing3, Ing5) = (45, 4.0, 14.0)으로 지정하는 경우:

- 예상 투과율: **83.15**
- 신뢰도 95%하에서 투과율의 **평균**: 최소 82.84 ~ 최대 83.46
- **개별 값들**: 최소 82.58 ~ 최대 83.72

::: {.callout-warning}
추정된 회귀식에 의한 예측은 **회귀 모형이 고려된 데이터의 범위 내**를 원칙으로 합니다. 외삽(extrapolation)은 주의가 필요합니다.
:::

---

## 정성적 분석 방법 {#qualitative}

![슬라이드 121](../images/ch05/slide_121.png){width=100%}

계량적인 Data의 수집이 제한된 경우 또는 계량적인 Data 수집의 사전 준비 작업으로, **정성적인 분석**을 고려할 수 있습니다.

### 연관도법

![슬라이드 122](../images/ch05/slide_122.png){width=100%}

**목적:** 도출된 가인자들 간의 인과관계를 기술적으로 확인하여, 치명인자 여부를 선정할 때 유용

**절차:**

1. 가인자들을 원 형태로 배치
2. 가인자들간의 인과관계를 화살표로 지정 (원인 → 결과)
3. 각 가인자별로 결과(In)와 원인(Out)의 숫자를 기록하고 해석
4. **Out의 수가 많은 인자**를 중요 인자로 간주

### AHP (Analytical Hierarchy Process)

![슬라이드 123](../images/ch05/slide_123.png){width=100%}

**목적:** 가인자들 간의 중요도를 상호 비교하여, 상대적으로 중요한 인자를 선별

**절차:**

1. 가인자들을 동일한 순서로 가로(열), 세로(행)에 배치
2. 가로에 배치된 인자가 세로에 배치된 인자보다 중요할 경우 **"1"점** 부여 (반대일 경우 **"0"점**)
3. 열의 합을 구해, **높은 값**을 갖는 인자들을 중요인자로 분류

### 결과 요약 정리

![슬라이드 124](../images/ch05/slide_124.png){width=100%}

선정된 치명인자(Vital Few)와 근본원인 그리고 개선 가능한 방향에 대해 정리합니다.

- 고려된 가인자 나열
- 분석결과: 정성적/정량적 분석 방법과 결과 정리
- 치명인자 여부: 도출된 가인자 중 확인된 치명인자 여부를 기록

---

## 실습: 회귀분석 도구

<div class="streamlit-embed">
<iframe
  src="https://sixsigma-apps.streamlit.app/Regression?embed=true"
  height="800"
  style="width:100%;border:none;">
</iframe>
</div>

::: {.callout-note title="실습 도구 사용법"}
1. 데이터 선택 또는 CSV 업로드
2. 종속변수(Y)와 독립변수(X) 선택
3. 분석 유형 선택 (상관분석 / 단순회귀 / 다중회귀)
4. **▶ 분석 실행** → 회귀식, 잔차 진단 그래프 확인
:::
